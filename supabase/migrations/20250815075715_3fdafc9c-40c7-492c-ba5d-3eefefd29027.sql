-- Insert sample data into fact_premiums for analytics
INSERT INTO fact_premiums (tenant_id, policy_id, insurer_id, product_id, branch_id, agent_id, txn_type, premium_amount, gst_amount, currency, txn_date, dim_date_id) VALUES
(1, 100001, 1, 1, 1, 1, 'issue', 25000, 4500, 'INR', '2025-01-15', 20250115),
(1, 100002, 1, 2, 1, 2, 'issue', 35000, 6300, 'INR', '2025-01-16', 20250116),
(1, 100003, 2, 1, 2, 1, 'renewal', 28000, 5040, 'INR', '2025-01-17', 20250117),
(1, 100004, 1, 3, 1, 3, 'issue', 45000, 8100, 'INR', '2025-01-18', 20250118),
(1, 100005, 3, 2, 3, 2, 'endorsement', 32000, 5760, 'INR', '2025-01-19', 20250119),
(1, 100006, 1, 1, 1, 1, 'issue', 22000, 3960, 'INR', '2025-02-01', 20250201),
(1, 100007, 2, 2, 2, 2, 'issue', 38000, 6840, 'INR', '2025-02-02', 20250202),
(1, 100008, 1, 1, 1, 3, 'renewal', 26000, 4680, 'INR', '2025-02-03', 20250203),
(1, 100009, 3, 3, 3, 1, 'issue', 50000, 9000, 'INR', '2025-02-04', 20250204),
(1, 100010, 1, 2, 1, 2, 'issue', 30000, 5400, 'INR', '2025-02-05', 20250205),
(1, 100011, 2, 1, 2, 1, 'issue', 24000, 4320, 'INR', '2025-03-01', 20250301),
(1, 100012, 1, 3, 1, 3, 'renewal', 42000, 7560, 'INR', '2025-03-02', 20250302),
(1, 100013, 3, 2, 3, 2, 'issue', 36000, 6480, 'INR', '2025-03-03', 20250303),
(1, 100014, 1, 1, 1, 1, 'issue', 28000, 5040, 'INR', '2025-03-04', 20250304),
(1, 100015, 2, 2, 2, 2, 'endorsement', 33000, 5940, 'INR', '2025-03-05', 20250305),
(1, 100016, 1, 1, 1, 3, 'issue', 27000, 4860, 'INR', '2025-04-01', 20250401),
(1, 100017, 3, 3, 3, 1, 'issue', 48000, 8640, 'INR', '2025-04-02', 20250402),
(1, 100018, 1, 2, 1, 2, 'renewal', 31000, 5580, 'INR', '2025-04-03', 20250403),
(1, 100019, 2, 1, 2, 1, 'issue', 25000, 4500, 'INR', '2025-04-04', 20250404),
(1, 100020, 1, 3, 1, 3, 'issue', 44000, 7920, 'INR', '2025-04-05', 20250405),
(1, 100021, 3, 2, 3, 2, 'issue', 37000, 6660, 'INR', '2025-05-01', 20250501),
(1, 100022, 1, 1, 1, 1, 'renewal', 29000, 5220, 'INR', '2025-05-02', 20250502),
(1, 100023, 2, 2, 2, 2, 'issue', 34000, 6120, 'INR', '2025-05-03', 20250503),
(1, 100024, 1, 1, 1, 3, 'issue', 26000, 4680, 'INR', '2025-05-04', 20250504),
(1, 100025, 3, 3, 3, 1, 'endorsement', 46000, 8280, 'INR', '2025-05-05', 20250505),
(1, 100026, 1, 2, 1, 2, 'issue', 32000, 5760, 'INR', '2025-06-01', 20250601),
(1, 100027, 2, 1, 2, 1, 'issue', 23000, 4140, 'INR', '2025-06-02', 20250602),
(1, 100028, 1, 3, 1, 3, 'renewal', 43000, 7740, 'INR', '2025-06-03', 20250603),
(1, 100029, 3, 2, 3, 2, 'issue', 35000, 6300, 'INR', '2025-06-04', 20250604),
(1, 100030, 1, 1, 1, 1, 'issue', 28000, 5040, 'INR', '2025-06-05', 20250605),
(1, 100031, 2, 2, 2, 2, 'issue', 39000, 7020, 'INR', '2025-07-01', 20250701),
(1, 100032, 1, 1, 1, 3, 'renewal', 27000, 4860, 'INR', '2025-07-02', 20250702),
(1, 100033, 3, 3, 3, 1, 'issue', 49000, 8820, 'INR', '2025-07-03', 20250703),
(1, 100034, 1, 2, 1, 2, 'issue', 33000, 5940, 'INR', '2025-07-04', 20250704),
(1, 100035, 2, 1, 2, 1, 'endorsement', 24000, 4320, 'INR', '2025-07-05', 20250705),
(1, 100036, 1, 3, 1, 3, 'issue', 41000, 7380, 'INR', '2025-08-01', 20250801),
(1, 100037, 3, 2, 3, 2, 'issue', 38000, 6840, 'INR', '2025-08-02', 20250802),
(1, 100038, 1, 1, 1, 1, 'renewal', 30000, 5400, 'INR', '2025-08-03', 20250803),
(1, 100039, 2, 2, 2, 2, 'issue', 35000, 6300, 'INR', '2025-08-04', 20250804),
(1, 100040, 1, 1, 1, 3, 'issue', 29000, 5220, 'INR', '2025-08-05', 20250805);

-- Enable RLS on fact_premiums
ALTER TABLE fact_premiums ENABLE ROW LEVEL SECURITY;

-- Create RLS policies for fact_premiums
CREATE POLICY "Allow authenticated users to read fact_premiums" 
ON fact_premiums FOR SELECT 
USING (true);

CREATE POLICY "System admins can manage fact_premiums" 
ON fact_premiums FOR ALL 
USING (EXISTS (
  SELECT 1 FROM profiles 
  WHERE user_id = auth.uid() 
  AND role = 'system_admin'
));

-- Enable realtime for fact_premiums
ALTER TABLE fact_premiums REPLICA IDENTITY FULL;
ALTER PUBLICATION supabase_realtime ADD TABLE fact_premiums;